<!DOCTYPE html>
<html lang="nl" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Catalogus | Art Equipment Rental EHB</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>

    <header class="topbar">
    <div class="topbar-inner">
        <div class="brand">
            <div class="logo"></div>
            <div>
                Art Equipment Rental EHB
                <small>Reservatieplatform – Proof of Concept</small>
            </div>
        </div>

        <nav class="nav">
            <a th:href="@{/products}">Catalogus</a>
            <a th:href="@{/cart}">Winkelmand</a>
            <a th:href="@{/orders}">Mijn reservaties</a>
            <a th:href="@{/logout}">Logout</a>
            <a th:href="@{/profile}">Profiel</a>
        </nav>
    </div>
</header>

<main class="container">

    <div class="page-head">
        <div>
            <h1>Materiaalcatalogus</h1>
            <p>Reserveer professioneel materiaal voor je artistieke projecten</p>
        </div>
    </div>
    <form th:action="@{/products}" method="get" class="search-bar">

        <input type="hidden"
               name="category"
               th:if="${selectedCategory != null}"
               th:value="${selectedCategory}"/>

        <input type="text"
               name="q"
               placeholder="Zoek materiaal (bv. lamp, kabel, microfoon...)"
               th:value="${q}"
               class="search-input"/>

        <button type="submit" class="btn">
            Zoeken
        </button>

        <a th:href="@{/products}" class="btn-ghost">
            Reset
        </a>
    </form>

    <div class="filters">
        <a th:href="@{/products}" class="chip">Alle categorieën</a>

        <a th:each="c : ${categories}"
           th:href="@{/products(category=${c.id})}"
           th:text="${c.name}"
           class="chip">
        </a>
    </div>
    <form th:action="@{/products}" method="get" class="filters">

        <input type="hidden"
               name="category"
               th:if="${selectedCategory != null}"
               th:value="${selectedCategory}" />

        <input type="hidden"
               name="q"
               th:if="${q != null}"
               th:value="${q}" />

        <select name="sort"
                onchange="this.form.submit()"
                class="chip">

            <option value="">Sorteren op</option>

            <option value="name_asc"
                    th:selected="${selectedSort == 'name_asc'}">
                Naam A–Z
            </option>

            <option value="name_desc"
                    th:selected="${selectedSort == 'name_desc'}">
                Naam Z–A
            </option>

            <option value="price_asc"
                    th:selected="${selectedSort == 'price_asc'}">
                Prijs laag → hoog
            </option>

            <option value="price_desc"
                    th:selected="${selectedSort == 'price_desc'}">
                Prijs hoog → laag
            </option>
        </select>

    </form>

    <div class="grid">

        <div th:if="${#lists.isEmpty(products)}" class="card item">
            <p class="muted">Geen producten gevonden in deze categorie.</p>
        </div>

        <div th:each="p : ${products}" class="card product">

            <img class="product-img"
                 th:src="${p.imageUrl != null ? p.imageUrl : 'https://images.unsplash.com/photo-1517694712202-14dd9538aa97?auto=format&fit=crop&w=800&q=60'}"
                 alt="Product afbeelding">

            <div class="product-body">

                <h3 th:text="${p.name}">Productnaam</h3>
                <p th:text="${p.description}">Beschrijving</p>

                <div class="meta">
                    <span class="badge" th:text="${p.category.name}">Categorie</span>
                    <span class="badge">€ <span th:text="${p.pricePerDay}"></span> / dag</span>

                    <span class="badge">
        Stock: <strong th:text="${p.stock}"></strong>
    </span>

                    <span th:if="${p.stock > 5}" class="stock ok">Beschikbaar</span>
                    <span th:if="${p.stock > 0 and p.stock <= 5}" class="stock low">Beperkte stock</span>
                    <span th:if="${p.stock == 0}" class="stock out">Uitverkocht</span>
                </div>


                <form th:action="@{/cart/add}" method="post" class="reserve-form">

                    <input type="hidden" name="productId" th:value="${p.id}">

                    <div class="row">
                        <div>
                            <label>Dagen</label>
                            <input type="number"
                                   name="days"
                                   min="1"
                                   max="14"
                                   value="1"
                                   required>
                        </div>

                        <div>
                            <label>Aantal</label>
                            <input type="number"
                                   name="quantity"
                                   min="1"
                                   th:max="${p.stock}"
                                   value="1"
                                   th:disabled="${p.stock == 0}"
                                   required>
                        </div>
                    </div>

                    <div class="meta" style="margin-top:10px;">
        <span class="badge">
            € <span th:text="${p.pricePerDay}"></span> / dag
        </span>
                    </div>

                    <button type="submit"
                            class="btn"
                            th:disabled="${p.stock == 0}"
                            style="margin-top:10px;">
                        Reserveer materiaal
                    </button>
                </form>

            </div>
        </div>

    </div>

</main>

</body>
</html>
